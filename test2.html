<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Listings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.js"></script>
    <style>
        .choices__input {
            background-color: white !important;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4">

        <!-- Filter Section -->
        <div class="h-28 bg-white p-4 flex items-center justify-between rounded-lg shadow mb-4">
            <div class="flex items-center">
                <span class="text-xl font-semibold">Filters</span>
                <div class="border-l h-8 mx-4"></div>
                <div id="selected-filters" class="flex items-center space-x-2 overflow-x-auto">
                    <!-- Selected filter badges will be injected here -->
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="border-l h-8 mx-4"></div>
                <div class="flex items-center space-x-4">
                    <div class="w-64">
                        <select id="model-filter" multiple>
                            <option value="Toyota">Toyota</option>
                            <option value="Honda">Honda</option>
                            <option value="Ford">Ford</option>
                            <option value="BMW">BMW</option>
                            <option value="Mercedes-Benz">Mercedes-Benz</option>
                        </select>
                    </div>
                    <div class="w-64">
                        <div id="year-slider"></div>
                        <div class="flex justify-between text-sm mt-1">
                            <span id="year-min">2015</span>
                            <span id="year-max">2025</span>
                        </div>
                    </div>
                    <div class="w-64">
                        <select id="price-filter" class="w-full">
                            <option value="">Select Price Range</option>
                            <option value="5000-10000">$5,000 - $10,000</option>
                            <option value="10000-15000">$10,000 - $15,000</option>
                            <option value="15000-20000">$15,000 - $20,000</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="h-96 bg-white p-4 flex space-x-4 rounded-lg shadow mb-4">
            <img src="https://via.placeholder.com/600x400.png?text=Chart+1" alt="Chart 1" class="w-1/2 h-full object-cover rounded-lg">
            <img src="https://via.placeholder.com/600x400.png?text=Chart+2" alt="Chart 2" class="w-1/2 h-full object-cover rounded-lg">
        </div>

        <!-- Table Section -->
        <div class="h-[600px] bg-white rounded-lg shadow overflow-auto">
            <table id="listings-table" class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0">
                    <tr>
                        <th scope="col" class="px-6 py-3 cursor-pointer">listingId</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">make</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">model</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">year</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">mileage</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">price</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">title</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">isPremium</th>
                        <th scope="col" class="px-6 py-3">detailPageUrl</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">bodyType</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">engineCapacity</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">horsepower</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">transmissionType</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">cylinders</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">interiorColor</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">exteriorColor</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">doors</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">seatingCapacity</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">trim</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">warranty</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">fuelType</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">motorsTrim</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">spec</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">sellerType</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">location</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">neighbourhood</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">isNegotiable</th>
                        <th scope="col" class="px-6 py-3">thumbnailUrl</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">vehicleReference</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">isVerifiedUser</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">createdAt</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">added</th>
                        <th scope="col" class="px-6 py-3 cursor-pointer">last_updated</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dummy data will be injected here -->
                </tbody>
            </table>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Choices.js for multi-select dropdown
            const modelFilter = new Choices('#model-filter', {
                removeItemButton: true,
                searchEnabled: true,
                placeholder: true,
                placeholderValue: 'Select Models',
            });

            // Initialize noUiSlider for year range
            const yearSlider = document.getElementById('year-slider');
            noUiSlider.create(yearSlider, {
                start: [2015, 2025],
                connect: true,
                range: {
                    'min': 2015,
                    'max': 2025
                },
                step: 1,
                tooltips: true,
                format: {
                    to: function(value) {
                        return parseInt(value);
                    },
                    from: function(value) {
                        return parseInt(value);
                    }
                }
            });

            const yearMin = document.getElementById('year-min');
            const yearMax = document.getElementById('year-max');

            yearSlider.noUiSlider.on('update', function(values) {
                yearMin.innerHTML = values[0];
                yearMax.innerHTML = values[1];
            });

            // Dummy Data
            const dummyData = [];
            for (let i = 1; i <= 25; i++) {
                dummyData.push({
                    listingId: `ID${i}`,
                    make: ['Toyota', 'Honda', 'Ford', 'BMW', 'Mercedes-Benz'][Math.floor(Math.random() * 5)],
                    model: `Model ${String.fromCharCode(65 + i - 1)}`,
                    year: 2015 + Math.floor(Math.random() * 11),
                    mileage: Math.floor(Math.random() * 100000),
                    price: 5000 + Math.floor(Math.random() * 15000),
                    title: `2020 Sedan ${i}`,
                    isPremium: Math.random() > 0.5,
                    detailPageUrl: 'https://example.com',
                    bodyType: 'Sedan',
                    engineCapacity: '2.0L',
                    horsepower: 150 + i,
                    transmissionType: 'Automatic',
                    cylinders: 4,
                    interiorColor: 'Black',
                    exteriorColor: 'White',
                    doors: 4,
                    seatingCapacity: 5,
                    trim: 'Standard',
                    warranty: 'Yes',
                    fuelType: 'Gasoline',
                    motorsTrim: `Trim ${i}`,
                    spec: `Spec ${i}`,
                    sellerType: 'Dealer',
                    location: 'City',
                    neighbourhood: 'Downtown',
                    isNegotiable: Math.random() > 0.5,
                    thumbnailUrl: 'https://via.placeholder.com/150',
                    vehicleReference: `Ref${i}`,
                    isVerifiedUser: Math.random() > 0.5,
                    createdAt: '2023-10-26',
                    added: '2023-10-26',
                    last_updated: '2023-10-26'
                });
            }

            // Populate Table
            const tableBody = document.querySelector('#listings-table tbody');

            function populateTable(data) {
                tableBody.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b';
                    Object.entries(item).forEach(([key, value]) => {
                        const cell = document.createElement('td');
                        cell.className = 'px-6 py-4';
                        if (key === 'detailPageUrl') {
                            const link = document.createElement('a');
                            link.href = value;
                            link.textContent = 'View';
                            link.target = '_blank';
                            link.className = 'text-blue-600 hover:underline';
                            cell.appendChild(link);
                        } else {
                            cell.textContent = value;
                        }
                        row.appendChild(cell);
                    });
                    tableBody.appendChild(row);
                });
            }

            populateTable(dummyData);

            // Sorting
            const headers = document.querySelectorAll('#listings-table thead th');
            headers.forEach((header, index) => {
                if (header.classList.contains('cursor-pointer')) {
                    header.addEventListener('click', () => {
                        const isAscending = header.classList.contains('asc');
                        headers.forEach(h => h.classList.remove('asc', 'desc'));
                        header.classList.toggle(isAscending ? 'desc' : 'asc', true);
                        sortTable(index, !isAscending);
                    });
                }
            });

            function sortTable(columnIndex, ascending) {
                const rows = Array.from(tableBody.querySelectorAll('tr'));
                const sortedRows = rows.sort((a, b) => {
                    const aText = a.children[columnIndex].textContent.trim();
                    const bText = b.children[columnIndex].textContent.trim();

                    if (!isNaN(aText) && !isNaN(bText)) {
                        return ascending ? aText - bText : bText - aText;
                    }

                    return ascending ? aText.localeCompare(bText) : bText.localeCompare(aText);
                });

                sortedRows.forEach(row => tableBody.appendChild(row));
            }

            // Filtering
            const selectedFiltersContainer = document.getElementById('selected-filters');
            const priceFilter = document.getElementById('price-filter');

            function updateFilters() {
                const selectedModels = modelFilter.getValue(true);
                const yearRange = yearSlider.noUiSlider.get();
                const selectedPrice = priceFilter.value;

                let filteredData = [...dummyData];

                // Model filter
                if (selectedModels.length > 0) {
                    filteredData = filteredData.filter(item => selectedModels.includes(item.make));
                }

                // Year filter
                filteredData = filteredData.filter(item => item.year >= yearRange[0] && item.year <= yearRange[1]);

                // Price filter
                if (selectedPrice) {
                    const [minPrice, maxPrice] = selectedPrice.split('-').map(Number);
                    filteredData = filteredData.filter(item => item.price >= minPrice && item.price <= maxPrice);
                }

                populateTable(filteredData);
                updateFilterBadges();
            }

            function updateFilterBadges() {
                selectedFiltersContainer.innerHTML = '';
                const selectedModels = modelFilter.getValue(true);
                selectedModels.forEach(model => {
                    createBadge('Model', model, () => {
                        modelFilter.removeItem(model);
                        updateFilters();
                    });
                });

                const yearRange = yearSlider.noUiSlider.get();
                if (yearRange[0] !== 2015 || yearRange[1] !== 2025) {
                    createBadge('Year', `${yearRange[0]} - ${yearRange[1]}`, () => {
                        yearSlider.noUiSlider.set([2015, 2025]);
                        updateFilters();
                    });
                }

                if (priceFilter.value) {
                    const selectedOption = priceFilter.options[priceFilter.selectedIndex].text;
                    createBadge('Price', selectedOption, () => {
                        priceFilter.value = '';
                        updateFilters();
                    });
                }
            }

            function createBadge(type, value, onRemove) {
                const badge = document.createElement('div');
                badge.className = 'bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full flex items-center';
                badge.innerHTML = `
                    <span>${type}: ${value}</span>
                    <button class="ml-2 text-blue-800">&times;</button>
                `;
                badge.querySelector('button').addEventListener('click', onRemove);
                selectedFiltersContainer.appendChild(badge);
            }

            modelFilter.passedElement.element.addEventListener('change', updateFilters);
            yearSlider.noUiSlider.on('change', updateFilters);
            priceFilter.addEventListener('change', updateFilters);
        });
    </script>
</body>
</html>