<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container-fluid p-4">

    <!-- Filter Section -->
    <div class="card shadow-sm mb-4">
        <div class="card-body d-flex align-items-center justify-content-between" style="height: 6rem;">
            <div class="d-flex align-items-center h-100 w-50">
                <h2 class="h5 mb-0">Filters</h2>
                <div class="vr mx-4"></div>
                <div id="selected-filters-container" class="flex-grow-1 overflow-auto text-nowrap py-1 pe-4">
                    <span class="text-muted small">No filters applied</span>
                    <!-- Badges will be dynamically inserted here -->
                </div>
            </div>

            <div class="d-flex align-items-center h-100">
                <div class="vr mx-4"></div>
                <div class="d-flex align-items-center gap-4">
                    <!-- Model Dropdown -->
                    <div class="dropdown">
                        <button id="model-dropdown-button" class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Model
                        </button>
                        <div id="model-dropdown" class="dropdown-menu p-3" style="width: 240px;">
                            <div class="mb-3">
                                <label for="model-search" class="visually-hidden">Search</label>
                                <input type="text" id="model-search" class="form-control" placeholder="Search model">
                            </div>
                            <ul class="list-unstyled overflow-auto" style="max-height: 200px;" aria-labelledby="model-dropdown-button">
                                <li><div class="form-check dropdown-item"><input class="form-check-input" type="checkbox" value="Toyota" id="checkbox-item-1"><label class="form-check-label ms-2" for="checkbox-item-1">Toyota</label></div></li>
                                <li><div class="form-check dropdown-item"><input class="form-check-input" type="checkbox" value="Honda" id="checkbox-item-2"><label class="form-check-label ms-2" for="checkbox-item-2">Honda</label></div></li>
                                <li><div class="form-check dropdown-item"><input class="form-check-input" type="checkbox" value="Ford" id="checkbox-item-3"><label class="form-check-label ms-2" for="checkbox-item-3">Ford</label></div></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Year Range Slider -->
                    <div style="width: 192px;">
                        <label for="year-range" class="form-label text-center">Year: <span id="year-label">2015 - 2025</span></label>
                        <input id="year-range" type="range" multiple value="2015,2025" min="2015" max="2025" class="form-range">
                    </div>

                    <!-- Price Dropdown -->
                    <div class="dropdown">
                         <button id="price-dropdown-button" class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Price Range
                        </button>
                        <ul id="price-dropdown" class="dropdown-menu" aria-labelledby="price-dropdown-button">
                             <li><a href="#" class="dropdown-item" data-value="5000-10000">$5k - $10k</a></li>
                             <li><a href="#" class="dropdown-item" data-value="10000-15000">$10k - $15k</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <img src="https://via.placeholder.com/800x400.png?text=Chart+Placeholder+1" alt="Chart 1" class="img-fluid rounded">
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <img src="https://via.placeholder.com/800x400.png?text=Chart+Placeholder+2" alt="Chart 2" class="img-fluid rounded">
            </div>
        </div>
    </div>


    <!-- Table Section -->
    <div class="card shadow-sm" style="flex-grow: 3; overflow: hidden; position: relative;">
        <div class="overflow-auto h-100">
            <table id="data-table" class="table table-striped table-hover">
                <thead class="table-light sticky-top">
                    <tr>
                        <th scope="col" class="px-3 py-2" style="cursor: pointer;">listingId</th>
                        <th scope="col" class="px-3 py-2" style="cursor: pointer;">make</th>
                        <th scope="col" class="px-3 py-2" style="cursor: pointer;">model</th>
                        <th scope="col" class="px-3 py-2" style="cursor: pointer;">year</th>
                        <th scope="col" class="px-3 py-2" style="cursor: pointer;">price</th>
                        <th scope="col" class="px-3 py-2">detailPageUrl</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be dynamically inserted here -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const tableBody = document.querySelector('#data-table tbody');
    let tableData = [];
    let sortState = {};

    // Generate Dummy Data
    const generateDummyData = (count) => {
        const data = [];
        const makes = ['Toyota', 'Honda', 'Ford'];
        for (let i = 1; i <= count; i++) {
            const make = makes[Math.floor(Math.random() * makes.length)];
            data.push({
                listingId: `ID-${1000 + i}`,
                make: make,
                model: `${make} Model ${i}`,
                year: 2015 + Math.floor(Math.random() * 11),
                price: 5000 + Math.floor(Math.random() * 15000),
                detailPageUrl: `https://example.com/listing/${1000 + i}`
            });
        }
        return data;
    };

    // Render Table
    const renderTable = (data) => {
        tableBody.innerHTML = '';
        data.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="px-3 py-2">${row.listingId}</td>
                <td class="px-3 py-2">${row.make}</td>
                <td class="px-3 py-2">${row.model}</td>
                <td class="px-3 py-2">${row.year}</td>
                <td class="px-3 py-2">$${row.price.toLocaleString()}</td>
                <td class="px-3 py-2"><a href="${row.detailPageUrl}" target="_blank">View</a></td>
            `;
            tableBody.appendChild(tr);
        });
    };

    // Sorting Logic
    document.querySelectorAll('#data-table thead th').forEach(header => {
        if (header.style.cursor === 'pointer') {
            header.addEventListener('click', () => {
                const columnKey = header.textContent;
                const currentDirection = sortState[columnKey] || 'desc';
                const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
                sortState = { [columnKey]: newDirection };

                const sortedData = [...tableData].sort((a, b) => {
                    if (a[columnKey] < b[columnKey]) return newDirection === 'asc' ? -1 : 1;
                    if (a[columnKey] > b[columnKey]) return newDirection === 'asc' ? 1 : -1;
                    return 0;
                });

                renderTable(sortedData);
            });
        }
    });

    // Filtering Logic
    const filters = {
        models: new Set(),
        year: { min: 2015, max: 2025 },
        price: null
    };

    const applyFilters = () => {
        let filteredData = [...tableData];
        if (filters.models.size > 0) {
            filteredData = filteredData.filter(item => filters.models.has(item.make));
        }
        if (filters.price) {
            const [min, max] = filters.price.split('-').map(Number);
            filteredData = filteredData.filter(item => item.price >= min && item.price <= max);
        }

        renderTable(filteredData);
        updateBadges();
    };
    
    // Badge Logic
    const badgesContainer = document.getElementById('selected-filters-container');
    const updateBadges = () => {
        badgesContainer.innerHTML = '';
        let hasFilters = false;

        filters.models.forEach(model => {
            hasFilters = true;
            const badge = createBadge(`Model: ${model}`, () => {
                filters.models.delete(model);
                document.querySelector(`#model-dropdown input[value="${model}"]`).checked = false;
                applyFilters();
            });
            badgesContainer.appendChild(badge);
        });
        
        if (filters.price) {
            hasFilters = true;
            const badge = createBadge(`Price: ${filters.price}`, () => {
                filters.price = null;
                applyFilters();
            });
            badgesContainer.appendChild(badge);
        }

        if (!hasFilters) {
            badgesContainer.innerHTML = '<span class="text-muted small">No filters applied</span>';
        }
    };
    
    const createBadge = (text, removeCallback) => {
        const badge = document.createElement('span');
        badge.className = 'badge bg-primary me-2';
        badge.innerHTML = `${text} <button type="button" class="btn-close btn-close-white ms-2" aria-label="Close"></button>`;
        badge.querySelector('button').onclick = removeCallback;
        return badge;
    };

    // Event Listeners for filters
    document.querySelectorAll('#model-dropdown input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) filters.models.add(e.target.value);
            else filters.models.delete(e.target.value);
            applyFilters();
        });
    });
    
    document.querySelectorAll('#price-dropdown a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            filters.price = e.target.getAttribute('data-value');
            applyFilters();
        });
    });

    // Search in model dropdown
    document.getElementById('model-search').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        document.querySelectorAll('#model-dropdown ul li').forEach(li => {
            const label = li.querySelector('label').textContent.toLowerCase();
            li.style.display = label.includes(searchTerm) ? '' : 'none';
        });
    });

    // Initial Load
    tableData = generateDummyData(25);
    renderTable(tableData);
});
</script>

</body>
</html>